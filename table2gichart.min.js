/*!
---
description: Generating Google Interactiv Charts from accessible HTML tables.

authors:
  - Ren√© Grosseck (http://www.electric-solutions.de)

license:
  - MIT-style license

requires:
  core/1.5: '*'

provides:
  - table2gichart
...
 */
var Table2GIChart=new Class({Implements:[Options,Events],options:{title:"",size:"600x400",tableView:"clear",chart:"PieChart",chartId:null,chartClass:"piechart",},role_index:[],initialize:function(b,a){this.setOptions(a);this.tab2chart=b;this.parse_table();this.tab2chart.addClass("tgic-done")},parse_table:function(){if(!this.tab2chart.get("id")){this.tab2chart.set("id",String.uniqueID())}this.container_id=this.tab2chart.id.replace(/(:|\.)/g,"_")+"_tgic";var d=this.tab2chart.get("data-title")||"",e=this.tab2chart.get("data-size")||this.options.size,c=this.tab2chart.get("data-chart")||this.options.chart;tw=this.tab2chart.get("data-tableview")||this.options.tableView,id=this.tab2chart.get("data-chartid")||this.options.chartId;e=e.split("x");var a=[],b={};this.options=Object.merge(this.options,{chart:c,title:d,width:e[0],height:e[1]});this.tab2chart.getElements("tr").each(function(j,g){a[g]=[];var f=j.get("data-url")!=null?j.get("data-url"):false;var h=j.get("data-style")!=null?j.get("data-style"):false;j.getElements("th, td").each(function(k,i){if(k.get("html").contains("href")){f=k.get("html").toElement().get("href")||f}a[g][i]=Number.from(k.get("text"))||k.get("text")});if(typeOf(h)!="boolean"){a[g].push(h);Object.merge(b,{style:true})}if(typeOf(f)!="boolean"){a[g].push(f);Object.merge(b,{url:true})}});Object.each(b,function(h,g){if(h==true){var f=a[0].push({role:g});this.role_index[g]=f-1}},this);if($(id)){this.container_id=id;if(tw=="show"){}else{if(tw=="clear"){$(this.tab2chart).dispose()}else{$(this.tab2chart).setStyle("display","none")}}}else{this.container=new Element("div",{id:this.container_id,"class":this.options.chartClass});if(tw=="show"){}else{if(tw=="clear"){this.container.replaces(this.tab2chart)}else{$(this.tab2chart).setStyle("display","none");this.container.inject(this.tab2chart,"before")}}}google.charts.setOnLoadCallback(this.loadchart.bind(this,a))},loadchart:function(a){this.datatable=google.visualization.arrayToDataTable(a);var b=window.google["visualization"][this.options.chart];if(typeOf(b)==="function"){this.chart=new b(document.getElementById(this.container_id))}else{this.chart=new google.visualization.PieChart(document.getElementById(this.container_id))}google.visualization.events.addListener(this.chart,"click",this.handler_click.bind(this));google.visualization.events.addListener(this.chart,"error",this.handler_error.bind(this));google.visualization.events.addListener(this.chart,"onmouseover",this.handler_mouseover.bind(this));google.visualization.events.addListener(this.chart,"onmouseout",this.handler_mouseout.bind(this));google.visualization.events.addListener(this.chart,"ready",this.handler_ready.bind(this));google.visualization.events.addListener(this.chart,"select",this.handler_select.bind(this));this.chart.draw(this.datatable,this.options)},handler_click:function(a){this.fireEvent("click",[a,this])},handler_error:function(b,a){this.fireEvent("error",[b,a,this])},handler_mouseover:function(b,a){this.fireEvent("mouseover",[b,a,this])},handler_mouseout:function(b,a){this.fireEvent("mouseout",[b,a,this])},handler_ready:function(){this.fireEvent("ready",this)},handler_select:function(){var b=this.chart.getSelection();if(this.role_index.url){var a=this.datatable.getValue(b[0]["row"],this.role_index.url);if(a.length){location.href=a}}this.fireEvent("select",this)}});var libloaded=(typeof google==="undefined")||(typeof google.visualization==="undefined")?false:true;Elements.implement({table2gichart:function(a){return this.each(function(c){if(!libloaded){google.charts.load("current",{packages:["corechart"]});libloaded=true}if(!c.hasClass("tgic-done")){var b=new Table2GIChart(c,a);return b}})}});String.implement({toElement:(function(){var a=new Element("div");return function(b){return a.set("html",this).getFirst().addEvents(b)}})()});